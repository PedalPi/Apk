<ion-header>
  <ion-navbar>
    <ion-title>
      {{patch.name}}
    </ion-title>

    <ion-buttons end>
      <button id="add-patch" royal (click)="setEffect()">
        <ion-icon name="create"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content class="patch">
  <button id="effects" clear (click)="manageEffects()"><ion-icon name="md-shuffle"></ion-icon></button>
  <sr-tabs id="tabs">

    <sr-tab *ngFor="let effect of patch.effects" title="{{effect.name}}">
      <div class="effect-header">
        <h3>{{effect.title}}</h3>
        <ion-toggle [checked]="effect.status" (ionChange)=toggleEffectStatus(effect)></ion-toggle>
        <ion-icon name="arrow-forward"></ion-icon>
        <ion-icon name="arrow-back"></ion-icon>
      </div>

      <div *ngFor="let parameter of effect.ports.control.input">
        <sr-slider
          *ngIf="
             parameter.properties.indexOf('enumeration') == -1
          && parameter.properties.indexOf('toggled') == -1
          "
          (onChange)="onParamUpdated(effect, parameter, parameter.value)"
          [parameter]="parameter"></sr-slider>

        <sr-knob
          *ngIf="
             parameter.properties.indexOf('enumeration') == -1
          && parameter.properties.indexOf('toggled') == -1
          "
          (onChange)="onParamUpdated(effect, parameter, $event)"
          [value]="parameter.value"
          [min]="parameter.ranges.minimum"
          [max]="parameter.ranges.maximum"
          type="image"
          src="https://camo.githubusercontent.com/7373c162747ff5b35359ccdf5faf0e8d104a889f/687474703a2f2f7777772e666162696f62696f6e64692e636f6d2f64656d6f2f6769746875622f616e67756c61722d747765656e6d61782d647261676761626c652d6b6e6f622f64656d6f2f696d67732f6b6e6f622e706e67"
          ></sr-knob>

        <sr-knob
          *ngIf="
             parameter.properties.indexOf('enumeration') == -1
          && parameter.properties.indexOf('toggled') == -1
          "
          (onChange)="onParamUpdated(effect, parameter, $event)"
          [value]="parameter.value"
          [min]="parameter.ranges.minimum"
          [max]="parameter.ranges.maximum"
          type="image"
          sprite="https://raw.githubusercontent.com/moddevices/mod-sdk/master/html/resources/knobs/boxy/aluminium.png"
          spriteSize="128"
          spritesTotal="64"
          ></sr-knob>

        <sr-combobox
          *ngIf="parameter.properties.indexOf('enumeration') != -1"
          (onChange)="onParamUpdated(effect, $event)"
          [parameter]="parameter"
          [selected]="parameter.value"
          ></sr-combobox>
        <sr-toggle
          *ngIf="parameter.properties.indexOf('toggled') != -1"
          (onChange)="onParamUpdated(effect, $event)"
          [parameter]="parameter"></sr-toggle>
      </div>
    </sr-tab>


    <div id="info" *ngIf="patch.effects.length === 0">
      <ion-icon name="md-shuffle"></ion-icon>
      Add effects in the patch
    </div>
  </sr-tabs>
</ion-content>

<ion-footer>
  <ion-toolbar position="bottom" id="footer">
    <ion-card class="ion-card-clicable no-shadow ion-card-item">
      <button ion-item (click)="toBeforePatch()">
        <ion-icon name="arrow-back"></ion-icon>
        <span class="label">{{beforePatch.name}}</span>
      </button>
    </ion-card>

    <!--
    <div id="connections">
      <ion-icon center>
        <img src="img/conection-plug.svg" />
      </ion-icon>
      <span class="label">Connections</span>
    </div>
    -->

    <ion-card class="ion-card-clicable no-shadow ion-card-item">
      <button ion-item (click)="toNextPatch()">
        <ion-icon name="arrow-forward"></ion-icon>
        <span class="label">{{nextPatch.name}}</span>
      </button>
    </ion-card>
  </ion-toolbar>
</ion-footer>
